"""
Conocimiento sobre la Historia de Guinea Ecuatorial.
Desde la época precolonial hasta la actualidad.
"""

HISTORIA = {
    "precolonial": {
        "titulo_es": "Época Precolonial",
        "titulo_fang": "Época ya Antes ya Colonización",
        "periodo": "Antes del siglo XV",
        "contenido_es": [
            "Los pueblos Bubis habitaban la isla de Bioko (antes Fernando Poo) desde hace miles de años",
            "Los Fang migraron desde el interior de África Central hacia la región continental en oleadas entre los siglos XVII y XIX",
            "Otros grupos étnicos incluyen: Ndowé (Combe), Bisió, Annoboneses y Fernandinos",
            "La isla de Annobón estaba originalmente deshabitada antes de la llegada de los portugueses",
            "Los pueblos originarios tenían sistemas políticos basados en consejos de ancianos y jefaturas",
            "La economía se basaba en la agricultura de subsistencia, caza, pesca y comercio local",
            "La religión tradicional incluía el culto a los ancestros y creencias animistas",
        ],
    },

    "portuguesa": {
        "titulo_es": "Período Portugués (1471-1778)",
        "titulo_fang": "Período ya Portugal (1471-1778)",
        "periodo": "1471-1778",
        "contenido_es": [
            "1471: El navegante portugués Fernão do Pó descubre la isla de Bioko, nombrándola Formosa",
            "1472: Portugal descubre la isla de Annobón y las islas de Corisco, Elobey Grande y Elobey Chico",
            "Portugal colonizó las islas pero prestó poca atención al territorio continental",
            "Se establecieron plantaciones de caña de azúcar con mano de obra esclava en las islas",
            "1778: Por el Tratado de El Pardo, Portugal cede a España las islas de Fernando Poo y Annobón, "
            "así como los derechos sobre la costa continental entre el Níger y el Ogué",
            "España adquirió los territorios a cambio de territorios en América del Sur (actual Brasil)",
        ],
    },

    "colonial_espanola": {
        "titulo_es": "Período Colonial Español (1778-1968)",
        "titulo_fang": "Período ya España (1778-1968)",
        "periodo": "1778-1968",
        "contenido_es": [
            "1778: España recibe los territorios por el Tratado de El Pardo con Portugal",
            "1778-1843: Período de abandono - España apenas ejerce soberanía efectiva",
            "1827-1843: Gran Bretaña establece una base naval en Clarence (actual Malabo) con permiso español",
            "1843: España recupera la administración efectiva de Fernando Poo con Juan José de Lerena",
            "1858: Se crea la Gobernación de los Territorios Españoles del Golfo de Guinea",
            "1885: Conferencia de Berlín - España logra el reconocimiento de su soberanía continental",
            "1900: Tratado de París - Fija las fronteras definitivas entre España y Francia (territorio reducido)",
            "1904-1936: Desarrollo de plantaciones de cacao y café (Fernando Poo se convierte en gran productor)",
            "1926: Unificación administrativa de los territorios insulares y continentales",
            "1936-1939: Guerra Civil Española - El territorio permanece bajo control republicano inicialmente",
            "1959: Los territorios se convierten en 'provincias españolas' (Fernando Poo y Río Muni)",
            "1963: Se concede autonomía interna bajo presión de la ONU",
            "1964: Bonifacio Ondó Edú es nombrado Presidente del Gobierno Autónomo",
            "1968: España concede la independencia tras referéndum constitucional",
        ],
    },

    "independencia": {
        "titulo_es": "La Independencia (1968)",
        "titulo_fang": "Independencia (1968)",
        "periodo": "12 de octubre de 1968",
        "contenido_es": [
            "11 de agosto de 1968: Referéndum constitucional aprueba la Constitución con el 63% de votos",
            "22 de septiembre de 1968: Elecciones presidenciales - Francisco Macías Nguema gana la segunda vuelta",
            "12 de octubre de 1968: Proclamación oficial de la independencia de Guinea Ecuatorial",
            "Guinea Ecuatorial se convierte en el único país hispanófono de África subsahariana",
            "Francisco Macías Nguema se convierte en el primer Presidente de la República",
            "La nueva nación ingresa en las Naciones Unidas el 12 de noviembre de 1968",
            "La fecha del 12 de octubre es celebrada como el Día de la Independencia Nacional",
        ],
    },

    "primera_republica": {
        "titulo_es": "Primera República - Gobierno de Macías (1968-1979)",
        "titulo_fang": "Primera República - Gobierno ya Macías (1968-1979)",
        "periodo": "1968-1979",
        "contenido_es": [
            "1968: Francisco Macías Nguema asume la presidencia",
            "1969: Crisis política y intento de golpe de Estado atribuido a Atanasio Ndong Miyone",
            "1970: Se establece el partido único PUNT (Partido Único Nacional de los Trabajadores)",
            "1972: Macías se proclama Presidente Vitalicio",
            "1973: Nueva Constitución concentra todo el poder en el Presidente",
            "Período marcado por la represión política y el éxodo masivo de población",
            "La economía del cacao colapsó con la salida de trabajadores nigerianos y españoles",
            "Se estima que un tercio de la población huyó al exilio",
            "Las infraestructuras educativas y sanitarias se deterioraron gravemente",
            "3 de agosto de 1979: Golpe de Estado del Teniente Coronel Teodoro Obiang Nguema Mbasogo",
            "29 de septiembre de 1979: Macías Nguema es juzgado y ejecutado",
        ],
    },

    "segunda_republica": {
        "titulo_es": "Segunda República - Gobierno de Obiang (1979-presente)",
        "titulo_fang": "Segunda República - Gobierno ya Obiang (1979-presente)",
        "periodo": "1979-presente",
        "contenido_es": [
            "1979: Teodoro Obiang Nguema Mbasogo asume el poder tras el golpe de Estado",
            "1982: Nueva Constitución establece un sistema presidencialista",
            "1987: Se funda el PDGE (Partido Democrático de Guinea Ecuatorial)",
            "1991: Reforma constitucional introduce el multipartidismo",
            "1992: Primeras elecciones multipartidistas (legislativas)",
            "1995: Descubrimiento de grandes reservas de petróleo en el campo de Zafiro",
            "1996: Inicio de la producción petrolera a gran escala",
            "1999: Guinea Ecuatorial se adhiere a la OHADA y a la CEMAC",
            "2000s: Boom petrolero transforma la economía del país",
            "2007: Firma del acuerdo sobre la isla de Annobón",
            "2011: Referéndum constitucional aprueba reformas (Senado, Vicepresidencia, Tribunal Constitucional)",
            "2012: Nueva Constitución reformada entra en vigor",
            "2017: Guinea Ecuatorial ingresa como miembro de la CPLP (Comunidad de Países de Lengua Portuguesa)",
            "Guinea Ecuatorial se convierte en uno de los mayores productores de petróleo de África",
            "Desarrollo de infraestructuras: autopistas, ciudades nuevas (Oyala/Djibloho), hospitales",
        ],
    },

    "datos_actuales": {
        "titulo_es": "Guinea Ecuatorial Hoy",
        "titulo_fang": "Guinea Ecuatorial Mberé",
        "contenido_es": [
            "Nombre oficial: República de Guinea Ecuatorial",
            "Capital: Malabo (isla de Bioko) — Oyala/Djibloho (futura capital, continental)",
            "Ciudad más grande: Bata (región continental)",
            "Superficie: 28.051 km²",
            "Población: Aproximadamente 1.7 millones de habitantes",
            "Idiomas oficiales: Español, Francés y Portugués",
            "Lenguas nacionales: Fang, Bubi, Ndowé, Bisió, Annobonés",
            "Moneda: Franco CFA de África Central (XAF)",
            "Organización territorial: 2 regiones (Insular y Continental), 7 provincias, 19 distritos",
            "Miembro de: ONU, UA, CEMAC, OHADA, CPLP, OPEP",
            "Principal recurso económico: Petróleo y gas natural",
            "Otros recursos: Madera, cacao, café, pesca",
            "Religión mayoritaria: Cristianismo (católico)",
        ],
    },

    "etnias": {
        "titulo_es": "Grupos Étnicos de Guinea Ecuatorial",
        "titulo_fang": "Grupos Étnicos ya Guinea Ecuatorial",
        "grupos": [
            {
                "nombre": "Fang",
                "porcentaje": "~80% de la población",
                "ubicacion": "Región continental (Río Muni) y parte de Bioko",
                "descripcion": "Grupo étnico mayoritario. Pueblo de tradición guerrera y agrícola. Lengua: Fang.",
            },
            {
                "nombre": "Bubi",
                "porcentaje": "~15% de la población",
                "ubicacion": "Isla de Bioko",
                "descripcion": "Pueblo autóctono de Bioko. Cultura y tradiciones propias. Lengua: Bubi.",
            },
            {
                "nombre": "Ndowé (Combe/Playeros)",
                "porcentaje": "~3%",
                "ubicacion": "Costa continental",
                "descripcion": "Pueblo costero dedicado a la pesca. Incluye subgrupos Combe, Bujeba, Bapuku, Benga.",
            },
            {
                "nombre": "Annoboneses",
                "porcentaje": "~1%",
                "ubicacion": "Isla de Annobón",
                "descripcion": "Descendientes de esclavos portugueses. Lengua: Fá d'Ambô (criollo portugués).",
            },
            {
                "nombre": "Bisió (Bujeba)",
                "porcentaje": "<1%",
                "ubicacion": "Interior continental",
                "descripcion": "Pequeño grupo pigmeo del interior de Río Muni.",
            },
            {
                "nombre": "Fernandinos (Criollos)",
                "porcentaje": "<1%",
                "ubicacion": "Malabo",
                "descripcion": "Descendientes de esclavos liberados de Sierra Leona y otros lugares. Lengua: Pidgin English (Pichi).",
            },
        ],
    },
}


def buscar_historia(texto):
    """Busca información histórica relevante según el texto."""
    texto = texto.lower().strip()
    resultados = []

    keywords_map = {
        "precolonial": [
            "precolonial", "antes de colonia", "bubi", "originario",
            "ancestro", "antiguo", "ancianos", "tradición", "tradicion",
        ],
        "portuguesa": [
            "portugal", "portugués", "portugues", "fernando poo",
            "formosa", "1471", "1778", "tratado de el pardo",
        ],
        "colonial_espanola": [
            "colonial", "colonia", "españa", "español", "espanol",
            "gobernación", "gobernacion", "cacao", "río muni", "rio muni",
            "conferencia de berlín", "conferencia de berlin", "autonomía", "autonomia",
        ],
        "independencia": [
            "independencia", "12 de octubre", "1968", "macías", "macias",
            "referéndum", "referendum", "primer presidente",
        ],
        "primera_republica": [
            "primera república", "primera republica", "macías nguema", "macias nguema",
            "punt", "golpe de estado 1979", "presidente vitalicio",
        ],
        "segunda_republica": [
            "segunda república", "segunda republica", "obiang", "pdge",
            "petróleo", "petroleo", "multipartidismo", "democrático", "democratico",
            "boom petrolero", "oyala", "djibloho",
        ],
        "datos_actuales": [
            "datos", "actual", "hoy", "población", "poblacion", "superficie",
            "capital", "moneda", "idioma oficial", "opep", "cemac",
        ],
        "etnias": [
            "etnia", "etnias", "grupo étnico", "grupo etnico", "fang", "bubi",
            "ndowé", "ndowe", "annobonés", "annobones", "fernandino",
            "bisió", "bisio", "pueblo", "tribu",
        ],
    }

    for seccion, keywords in keywords_map.items():
        if any(kw in texto for kw in keywords):
            resultados.append(seccion)

    return resultados


def formatear_historia(secciones, idioma="es"):
    """Formatea las secciones de historia para respuesta."""
    texto = ""

    for seccion in secciones[:2]:  # Máximo 2 secciones
        datos = HISTORIA.get(seccion, {})
        titulo = datos.get(f"titulo_{idioma}", datos.get("titulo_es", ""))

        if seccion == "etnias":
            texto += f"*{titulo}:*\n\n"
            for grupo in datos["grupos"]:
                texto += f"*{grupo['nombre']}* ({grupo['porcentaje']})\n"
                texto += f"  Ubicación: {grupo['ubicacion']}\n"
                texto += f"  {grupo['descripcion']}\n\n"
        else:
            periodo = datos.get("periodo", "")
            texto += f"*{titulo}*"
            if periodo:
                texto += f" ({periodo})"
            texto += "\n\n"
            for item in datos.get("contenido_es", []):
                texto += f"- {item}\n"
            texto += "\n"

    if not texto:
        texto = formatear_resumen_historia(idioma)

    return texto.strip()


def formatear_resumen_historia(idioma="es"):
    """Retorna un resumen de los períodos históricos disponibles."""
    if idioma == "fang":
        return (
            "*Historia ya Guinea Ecuatorial*\n\n"
            "Fila uno ya temas yayie:\n"
            "- *precolonial* - Antes ya colonización\n"
            "- *portugal* - Período portugués (1471-1778)\n"
            "- *colonial* - Período español (1778-1968)\n"
            "- *independencia* - 12 ya octubre ya 1968\n"
            "- *macías* - Primera República (1968-1979)\n"
            "- *obiang* - Segunda República (1979-presente)\n"
            "- *etnias* - Grupos étnicos\n"
            "- *datos actuales* - Guinea Ecuatorial mberé"
        )
    return (
        "*Historia de Guinea Ecuatorial*\n\n"
        "Escribe uno de estos temas para más información:\n"
        "- *precolonial* - Época precolonial\n"
        "- *portugal* - Período portugués (1471-1778)\n"
        "- *colonial* - Período colonial español (1778-1968)\n"
        "- *independencia* - La Independencia (12 de octubre de 1968)\n"
        "- *macías* - Primera República (1968-1979)\n"
        "- *obiang* - Segunda República (1979-presente)\n"
        "- *etnias* - Grupos étnicos de GQ\n"
        "- *datos actuales* - Guinea Ecuatorial hoy"
    )
